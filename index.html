<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notes / Tasks</title>

    <style>
        body {
            margin: 0;
            background: #000;
            color: #fff;
            font-family: system-ui, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- CONTENT FRAME CONTAINER (for slide animation) --- */
        #frameWrap {
            position: relative;
            width: 100%;
            height: 0;
            overflow: hidden;
        }

        iframe {
            position: absolute;
            top: 0;
            left: 100%;
            width: 100%;
            height: 100%;
            border: none;
            background: #000;
            transition: transform 0.35s ease, opacity 0.35s ease;
        }

        iframe.active {
            transform: translateX(0);
            opacity: 1;
            left: 0;
        }

        iframe.slide-left {
            transform: translateX(-100%);
            opacity: 0;
        }

        iframe.slide-right {
            transform: translateX(100%);
            opacity: 0;
        }

        /* --- BOTTOM NAVIGATION TABS --- */
        .bottom-nav {
            height: 85px;
            background: #000;
            border-top: 1px solid #222;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .tab {
            text-align: center;
            opacity: 0.45;
            transition: opacity 0.2s, transform 0.25s, filter 0.25s;
            padding-top: 6px;
        }

        /* Glow + scale on active tab */
        .tab.active {
            opacity: 1;
            transform: scale(1.08);
            filter: drop-shadow(0 0 6px #40E0D0);
        }

        .tab img {
            width: 34px;
            height: 34px;
            display: block;
            margin: 0 auto;
        }

        .tab span {
            display: block;
            margin-top: 6px;
            font-size: 14px;
        }
    </style>
</head>

<body>

    <!-- SLIDING FRAME AREA -->
    <div id="frameWrap">
        <iframe id="notesFrame" src="notepad.html" class="active"></iframe>
        <iframe id="tasksFrame" src="index-mobile.html"></iframe>
    </div>

    <!-- BOTTOM TAB BAR -->
    <div class="bottom-nav">
        <div class="tab active" id="tabNotes">
            <img src="data:image/svg+xml;utf8,
                <svg xmlns='http://www.w3.org/2000/svg' fill='%23fff' width='48' height='48'>
                    <rect x='14' y='10' width='20' height='4' rx='2'/>
                    <rect x='14' y='20' width='20' height='4' rx='2'/>
                    <rect x='14' y='30' width='20' height='4' rx='2'/>
                </svg>">
            <span>Notes</span>
        </div>

        <div class="tab" id="tabTasks">
            <img src="data:image/svg+xml;utf8,
                <svg xmlns='http://www.w3.org/2000/svg' fill='%23fff' width='48' height='48'>
                    <rect x='10' y='10' width='28' height='28' rx='6'/>
                    <path d='M17 24l4 4 8-10' stroke='%23000' stroke-width='3' fill='none'/>
                </svg>">
            <span>Tasks</span>
        </div>
    </div>

    <script>
        function resizeFrame() {
            const navHeight = 85; // height of bottom nav bar
            const visibleHeight = window.innerHeight;
            document.getElementById("frameWrap").style.height = (visibleHeight - navHeight) + "px";
        }

        window.addEventListener("resize", resizeFrame);
        resizeFrame();
        const tabNotes = document.getElementById("tabNotes");
        const tabTasks = document.getElementById("tabTasks");

        const notesFrame = document.getElementById("notesFrame");
        const tasksFrame = document.getElementById("tasksFrame");

        function activateTab(activeTab) {
            tabNotes.classList.remove("active");
            tabTasks.classList.remove("active");
            activeTab.classList.add("active");
        }

        // Slide animation logic
        function showFrame(target) {
            if (target === "notes") {
                notesFrame.classList.add("active");
                notesFrame.classList.remove("slide-left", "slide-right");

                tasksFrame.classList.remove("active");
                tasksFrame.classList.add("slide-right");
            } else {
                tasksFrame.classList.add("active");
                tasksFrame.classList.remove("slide-left", "slide-right");

                notesFrame.classList.remove("active");
                notesFrame.classList.add("slide-left");
            }
        }

        tabNotes.onclick = () => {
            activateTab(tabNotes);
            showFrame("notes");
        };

        tabTasks.onclick = () => {
            activateTab(tabTasks);
            showFrame("tasks");
        };

// --- robust parent listener: forward refresh to notes iframe without reloading it ---
window.addEventListener("message", (event) => {
    const msg = event.data;
    // only accept messages from same origin or with expected shape
    if (!msg || !msg.action) return;

    // helper: ensure notes tab visible
    function showNotesTab() {
        activateTab(tabNotes);
        showFrame("notes");
    }

    // openEditor: open editor in notesFrame (keep src change only when opening editor)
    if (msg.action === "openEditor" && typeof msg.id !== "undefined") {
        // build url (only include pw if provided)
        let url = "editor.html?id=" + msg.id;
        if (msg.pw) url += "&pw=" + encodeURIComponent(msg.pw);
        notesFrame.src = url; // this is a navigation to editor
        showNotesTab();
        return;
    }

    // refresh / delete / duplicate / openNotes => tell the notes iframe to refresh in-place
    if (msg.action === "openNotes" ||
        msg.action === "refreshNotes" ||
        msg.action === "deleteAndReturn" ||
        msg.action === "duplicateAndReturn") {
            
    // If editor is open → navigate back to notes page
    if (!notesFrame.src.includes("notepad.html")) {
        notesFrame.src = "notepad.html";
    } else {
        // notes page is already loaded → just refresh the contents
        try {
            notesFrame.contentWindow.postMessage({ action: "refresh" }, "*");
        } catch (e) {
            notesFrame.src = "notepad.html"; // fallback reload
        }
    }
    showNotesTab();
    return;
}

    // any other messages can be handled here
});
    </script>
</body>

</html>